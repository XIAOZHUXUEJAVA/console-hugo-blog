<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>littlepig/old-posts/context/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://xxxdgblog.github.io/hugo-theme-console/css/terminal-0.7.2.min.css">
    <link rel="stylesheet" href="https://xxxdgblog.github.io/hugo-theme-console/css/animate-4.1.1.min.css">
    <link rel="stylesheet" href="https://xxxdgblog.github.io/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="每日小知识点(八) - 什么是Context上下文?" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xxxdgblog.github.io/old-posts/context/" /><meta property="article:published_time" content="2023-05-23T00:00:00+00:00" />



<meta name="twitter:title" content="每日小知识点(八) - 什么是Context上下文?"/>
<meta name="twitter:description" content="Daily Little Knowledge Points"/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://xxxdgblog.github.io/" class="no-style site-name">littlepig</a>:~# 
              <a href='https://xxxdgblog.github.io/old-posts'>old-posts</a>/<a href='https://xxxdgblog.github.io/old-posts/context'>context</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://xxxdgblog.github.io/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://xxxdgblog.github.io/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://xxxdgblog.github.io/photos/" typeof="ListItem">photos/</a></li>
                
                <li><a href="https://xxxdgblog.github.io/old-posts/" typeof="ListItem">old-posts/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>每日小知识点(八) - 什么是Context上下文?</h1>
<h1 id="什么是-context-上下文">什么是 Context 上下文？</h1>
<p>维基百科中提到：</p>
<p>在电脑科学中，<strong>任务（task）的上下文（英语：context）是一个任务所必不可少的一组数据（该任务可以是<a href="https://zh.wikipedia.org/wiki/%E8%A1%8C%E7%A8%8B">进程</a>、<a href="https://zh.wikipedia.org/wiki/%E7%BA%BF%E7%A8%8B">线程</a>）</strong>。这些数据允许任务<a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%96%B7">中断</a>，在这之后仍可在同一个地方继续执行。上下文的这一概念在中断的任务的场景下具有重大意义，其中，任务在被中断之后，处理器保存上下文并提供<a href="https://zh.wikipedia.org/w/index.php?title=%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86&amp;action=edit&amp;redlink=1">中断处理</a>（interrupt service routine）。因此，上下文越小，延迟越小。</p>
<p>上下文的数据可能存放于<a href="https://zh.wikipedia.org/wiki/%E5%AF%84%E5%AD%98%E5%99%A8">处理器寄存器</a>、任务所利用的内存、某些<a href="https://zh.wikipedia.org/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>管理的任务所使用的控制寄存器（control registers）。</p>
<h2 id="操作系统中的上下文">操作系统中的上下文</h2>
<p>我们可以理解为上下文是保存一个任务的数据（保存一个任务所运行的环境、情景），确保任务在中断或切换后能够无缝继续工作。</p>
<p><strong>举个具体的例子：</strong></p>
<p>假设你的计算机上同时运行着两个进程：一个是文本编辑器进程，另一个是浏览器进程。当你在文本编辑器中编写一段文字的同时，浏览器正在加载一个网页。</p>
<p>当操作系统需要切换从文本编辑器进程到浏览器进程时，它<strong>首先会保存当前文本编辑器进程的上下文</strong>。上下文包括该进程的程序计数器（记录当前指令的位置）、寄存器的值（包括通用寄存器和程序状态寄存器）以及其他与该进程相关的状态信息。</p>
<p>接下来，<strong>操作系统会加载浏览器进程的上下文</strong>。这意味着它会恢复浏览器进程之前保存的程序计数器、寄存器值和状态信息。一旦加载完毕，控制权就从文本编辑器进程切换到了浏览器进程</p>
<p><strong>再举个生活中的例子来说明：</strong></p>
<p>假设你在烹饪中同时进行两个任务：切菜和炒菜。当你需要暂时中断切菜，转而进行炒菜时，你会将切菜的状态保存下来，包括切割的进度、刀具的位置等等。然后，你开始进行炒菜的工作，同时保持了炒菜的上下文，包括炉灶的设置、锅中的食材等。</p>
<p>当你完成炒菜后，你可以通过加载切菜的上下文来恢复到之前的状态，继续切割菜品。这样，你能够从上一次工作的地方继续进行，而不需要重新开始。</p>
<h2 id="java-中的上下文切换的例子">Java 中的上下文切换的例子</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThreadSwitchDemo</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Thread thread1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyRunnable<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 1&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyRunnable<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 2&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyRunnable</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MyRunnable</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">);</span> <span style="color:#75715e">// sleep 一下，让线程的切换更加明显
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>我们创建了两个线程<code>thread1</code>和<code>thread2</code>，它们都执行同一个<code>MyRunnable</code>实例。每个线程通过循环打印数字 1 到 5，并在每次打印后休眠 1 秒。</p>
<p>当<code>thread1</code>开始执行时（假设 thread1 先开始执行，因为不确定哪个线程先执行，由操作系统的线程调度器决定），它会打印数字 1，并进行上下文切换，将 CPU 控制权切换给<code>thread2</code>。<code>thread2</code>接着开始执行，并打印数字 1。这个过程会一直重复，直到两个线程都执行完毕。</p>
<p>在每次切换线程时，操作系统需要保存当前线程的上下文信息，包括程序计数器的值、寄存器的内容和栈指针等。然后，它会加载下一个线程的上下文信息，并继续执行该线程。这样就完成了线程的切换。</p>
<p>当线程休眠结束后，操作系统会恢复线程的上下文，并从保存的状态继续执行线程。这意味着线程可以在上次休眠时的位置继续执行，而不是从头开始。</p>
<p>总结一句： <strong>通过上下文的保存和恢复，线程在被唤醒后可以继续执行，保留了先前的状态和进度。这就是上下文切换的作用。</strong></p>


        <div class="footer">
    Powered by <a href="https://gohugo.io/">Hugo + Github Pages</a> 
</div>

    </div>
  </body>
</html>
